默认出口关闭

 iptables -P OUTPUT DROP

 iptables -A OUTPUT -d 192.168.60.110 -j ACCEPT



Web重定向：

http,dns等:

iptables -t nat -I PREROUTING -p tcp -s 192.168.60.184 -m multiport --dport 80,8080,53 -j DNAT --to-destination 192.168.60.185:8080

iptables -t nat -I PREROUTING -p tcp -s 192.168.60.184  -j DNAT --to-destination 192.168.60.185:8080

https:

iptables -t nat -A PREROUTING -p tcp --dport 443 -j DNAT --to-destination 192.168.9.207:8082



直接越过防火墙（可用于实现白名单功能）

iptables -t raw -A PREROUTING -s 192.168.6.2  -j NOTRACK



#取消nat映射

iptables -t nat -D PREROUTING -d 10.20.58.37/32 -j DNAT --to-destination 192.168.16.6

ifconfig eth0 down



#####nat映射

# Generated by iptables-save v1.4.21 on Mon Nov 18 03:41:12 2019

*filter

:INPUT ACCEPT [140:40463]

:FORWARD DROP [0:0]

:OUTPUT ACCEPT [13:976]

-A FORWARD -s 192.168.16.0/24 -j ACCEPT

-A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT

-A FORWARD -p tcp -m tcp --dport 22 -j ACCEPT

-A FORWARD -p tcp -m tcp --dport 31162 -j ACCEPT

-A FORWARD -p tcp -m tcp --dport 3389 -j ACCEPT

-A FORWARD -d 192.168.16.0/24 -j ACCEPT

COMMIT

# Completed on Mon Nov 18 03:41:12 2019

# Generated by iptables-save v1.4.21 on Mon Nov 18 03:41:12 2019

*nat

:PREROUTING ACCEPT [643:75143]

:INPUT ACCEPT [122:10703]

:OUTPUT ACCEPT [65:4399]

:POSTROUTING ACCEPT [167:9709]

-A PREROUTING -d 10.20.58.33/32 -j DNAT --to-destination 192.168.16.2

-A PREROUTING -d 10.20.58.34/32 -j DNAT --to-destination 192.168.16.3

-A PREROUTING -d 10.20.58.32/32 -j DNAT --to-destination 192.168.16.4

-A PREROUTING -d 10.20.58.60/32 -j DNAT --to-destination 192.168.16.5

-A PREROUTING -d 10.20.58.37/32 -j DNAT --to-destination 192.168.16.6

-A POSTROUTING -s 192.168.16.0/24 -o eno16780032 -j SNAT --to-source 10.20.58.38

-A POSTROUTING -s 192.168.16.0/24 -o ens224 -j SNAT --to-source 192.168.16.1

COMMIT

# Completed on Mon Nov 18 03:41:12 2019



指定端口转发

iptables -t nat -I PREROUTING -p tcp -s 192.168.76.0/24 -m multiport --dport 80,8080 -j DNAT --to-destination 22.22.22.21:3000

全部tcp转发

iptables -t nat -I PREROUTING -p tcp  -j DNAT --to-destination 22.22.22.21:3000



放行ssh端口

iptables -t raw -A PREROUTING -p tcp -m multiport --dport 22,3306,3333,3000,3001 -j NOTRACK



放行114.114.114.114：

iptables -t raw -A PREROUTING -d 114.114.114.114 -j NOTRACK

iptables -A FORWARD -d 114.114.114.114 -j  ACCEPT



白名单规则：

iptables -t raw -A PREROUTING -s xx.xx.xx.xx/24 -j NOTRACK



icmp白名单

iptables -A FORWARD -p icmp -j DROP

iptables -I FORWARD -s 192.168.76.199 -p icmp -j ACCEPT 

iptables -D FORWARD -s 192.168.76.199 -p icmp -j ACCEPT

钉钉地址直接过

iptables -t raw -A PREROUTING -s xx.xx.xx.xx/24 -j NOTRACK



portal web服务：

http，https兼容

路径全部转到根目录





放行3333端口：

iptables -A INPUT -p tcp --dport  3333 -j ACCEPT

iptables -A INPUT -p tcp --dport  8880 -j ACCEPT

如果还不通，请确认3333对应服务是否正常启动

如果还不通，用了DOCKER？